<!-- base.html (templates/base.html) -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}GBV Reporting System{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px 0;
        }
        .main-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            padding: 40px;
            margin: 20px auto;
        }
        .header-section {
            text-align: center;
            margin-bottom: 30px;
        }
        .header-section h1 {
            color: #667eea;
            font-weight: 700;
        }
        .header-section p {
            color: #6c757d;
        }
        .form-label {
            font-weight: 600;
            color: #495057;
        }
        .btn-submit {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            padding: 12px 40px;
            font-weight: 600;
            border-radius: 25px;
        }
        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }
        .alert-section {
            border-left: 4px solid #667eea;
        }
    </style>
</head>
<body>
    <div class="container">
        {% block content %}
        {% endblock %}
    </div>
    <!-- Add this to your base.html before </body> tag -->

<!-- Chatbot Widget -->
<div id="chatbot-widget">
    <button id="chatbot-toggle" class="chatbot-toggle">
        <i class="bi bi-chat-dots-fill"></i>
        <span class="notification-badge" id="chat-badge">1</span>
    </button>
    
    <div id="chatbot-window" class="chatbot-window">
        <div class="chatbot-header">
            <div class="d-flex align-items-center">
                <div class="chatbot-avatar">
                    <i class="bi bi-robot"></i>
                </div>
                <div>
                    <h6 class="mb-0">Support Assistant</h6>
                    <small class="text-white-50">AI-powered help</small>
                </div>
            </div>
            <button id="chatbot-close" class="btn-close btn-close-white"></button>
        </div>
        
        <div class="chatbot-messages" id="chatbot-messages">
            <div class="message bot-message">
                <div class="message-avatar">
                    <i class="bi bi-robot"></i>
                </div>
                <div class="message-content">
                    <p>Hello! I'm here to provide support and answer any questions you may have about reporting violence or seeking help. How can I assist you today?</p>
                    <small class="message-time">Just now</small>
                </div>
            </div>
        </div>
        
        <div class="chatbot-suggestions" id="chatbot-suggestions">
            <button class="suggestion-btn" data-message="How do I report an incident?">
                How do I report an incident?
            </button>
            <button class="suggestion-btn" data-message="Is my report confidential?">
                Is my report confidential?
            </button>
            <button class="suggestion-btn" data-message="What types of violence can I report?">
                What types of violence can I report?
            </button>
            <button class="suggestion-btn" data-message="I need immediate help">
                I need immediate help
            </button>
        </div>
        
        <div class="chatbot-input">
            <input type="text" id="chatbot-message-input" placeholder="Type your message..." />
            <button id="chatbot-send" class="btn-send">
                <i class="bi bi-send-fill"></i>
            </button>
        </div>
        
        <div class="chatbot-typing" id="chatbot-typing" style="display: none;">
            <div class="typing-indicator">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <small>Assistant is typing...</small>
        </div>
    </div>
</div>

<style>
    #chatbot-widget {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 9999;
    }
    
    .chatbot-toggle {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        color: white;
        font-size: 24px;
        cursor: pointer;
        box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
        transition: all 0.3s;
        position: relative;
    }
    
    .chatbot-toggle:hover {
        transform: scale(1.1);
        box-shadow: 0 6px 25px rgba(102, 126, 234, 0.6);
    }
    
    .notification-badge {
        position: absolute;
        top: -5px;
        right: -5px;
        background: #e74c3c;
        color: white;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        font-weight: bold;
        animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.1); }
    }
    
    .chatbot-window {
        position: fixed;
        bottom: 100px;
        right: 20px;
        width: 400px;
        max-width: calc(100vw - 40px);
        height: 600px;
        max-height: calc(100vh - 140px);
        background: white;
        border-radius: 15px;
        box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        display: none;
        flex-direction: column;
        overflow: hidden;
    }
    
    .chatbot-window.active {
        display: flex;
        animation: slideUp 0.3s ease-out;
    }
    
    @keyframes slideUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .chatbot-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .chatbot-avatar {
        width: 40px;
        height: 40px;
        background: rgba(255,255,255,0.2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 10px;
        font-size: 20px;
    }
    
    .chatbot-messages {
        flex: 1;
        overflow-y: auto;
        padding: 20px;
        background: #f8f9fa;
    }
    
    .message {
        display: flex;
        margin-bottom: 20px;
        animation: fadeIn 0.3s;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .message-avatar {
        width: 35px;
        height: 35px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        flex-shrink: 0;
    }
    
    .bot-message .message-avatar {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        margin-right: 10px;
    }
    
    .user-message {
        flex-direction: row-reverse;
    }
    
    .user-message .message-avatar {
        background: #e0e0e0;
        color: #666;
        margin-left: 10px;
    }
    
    .message-content {
        max-width: 70%;
    }
    
    .message-content p {
        background: white;
        padding: 12px 15px;
        border-radius: 15px;
        margin: 0 0 5px 0;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        line-height: 1.5;
    }
    
    .user-message .message-content p {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }
    
    .message-time {
        color: #999;
        font-size: 11px;
        padding: 0 5px;
    }
    
    .chatbot-suggestions {
        padding: 10px;
        border-top: 1px solid #e0e0e0;
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
    }
    
    .suggestion-btn {
        background: #f0f0f0;
        border: 1px solid #e0e0e0;
        padding: 8px 15px;
        border-radius: 20px;
        font-size: 13px;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .suggestion-btn:hover {
        background: #667eea;
        color: white;
        border-color: #667eea;
    }
    
    .chatbot-input {
        display: flex;
        padding: 15px;
        border-top: 1px solid #e0e0e0;
        background: white;
    }
    
    #chatbot-message-input {
        flex: 1;
        border: 1px solid #e0e0e0;
        border-radius: 25px;
        padding: 10px 20px;
        outline: none;
        font-size: 14px;
    }
    
    #chatbot-message-input:focus {
        border-color: #667eea;
    }
    
    .btn-send {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        color: white;
        margin-left: 10px;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .btn-send:hover {
        transform: scale(1.1);
    }
    
    .chatbot-typing {
        padding: 10px 20px;
        display: flex;
        align-items: center;
        gap: 10px;
        background: #f8f9fa;
        border-top: 1px solid #e0e0e0;
    }
    
    .typing-indicator {
        display: flex;
        gap: 4px;
    }
    
    .typing-indicator span {
        width: 8px;
        height: 8px;
        background: #667eea;
        border-radius: 50%;
        animation: typing 1.4s infinite;
    }
    
    .typing-indicator span:nth-child(2) {
        animation-delay: 0.2s;
    }
    
    .typing-indicator span:nth-child(3) {
        animation-delay: 0.4s;
    }
    
    @keyframes typing {
        0%, 60%, 100% { transform: translateY(0); }
        30% { transform: translateY(-10px); }
    }
    
    @media (max-width: 768px) {
        .chatbot-window {
            width: calc(100vw - 40px);
            height: calc(100vh - 140px);
            bottom: 100px;
            right: 20px;
        }
    }
</style>

<script>
    // Rule-Based Chatbot Configuration
    let conversationHistory = [];
    let userName = '';
    
    // Knowledge Base - Questions and Answers
    const knowledgeBase = {
        greetings: {
            keywords: ['hello', 'hi', 'hey', 'good morning', 'good afternoon', 'good evening', 'greetings'],
            responses: [
                "Hello! I'm here to support you. How can I help you today?",
                "Hi there! I'm here to answer your questions about reporting and support. What would you like to know?",
                "Welcome! I'm here to assist you with any questions or concerns you may have."
            ]
        },
        howToReport: {
            keywords: ['how', 'report', 'submit', 'file', 'make a report', 'reporting process', 'start'],
            responses: [
                "To report an incident:\n\n1. Fill out the form on this page with your information\n2. Select the type of violence from the dropdown\n3. Describe what happened in detail\n4. Add the location where it occurred\n5. Upload evidence if you have any (optional)\n6. Click 'Submit Report'\n\nYour report will be reviewed by our trained staff confidentially."
            ]
        },
        confidentiality: {
            keywords: ['confidential', 'private', 'secret', 'anonymous', 'privacy', 'who will see', 'safe'],
            responses: [
                "Your privacy and safety are our top priorities. Here's how we protect you:\n\nâœ“ All reports are confidential\nâœ“ Only authorized staff can access reports\nâœ“ Your information is encrypted and secure\nâœ“ You can choose to remain anonymous\nâœ“ We never share your information without consent\n\nYou are in control of your story."
            ]
        },
        violenceTypes: {
            keywords: ['types', 'kind', 'violence', 'abuse', 'what can i report', 'categories'],
            responses: [
                "You can report the following types of violence:\n\nðŸ”¸ Physical Violence - Hitting, slapping, pushing, restraining\nðŸ”¸ Sexual Violence - Rape, assault, harassment, coercion\nðŸ”¸ Emotional Abuse - Threats, intimidation, humiliation\nðŸ”¸ Economic Abuse - Controlling money, preventing work\nðŸ”¸ Other - Any form of violence not listed above\n\nAll forms of violence are serious and deserve support."
            ]
        },
        immediateHelp: {
            keywords: ['emergency', 'help', 'danger', 'urgent', 'crisis', 'now', 'immediate', 'scared', 'afraid'],
            responses: [
                "âš ï¸ If you are in immediate danger:\n\nðŸš¨ Call Emergency Services: 999\nðŸ“ž National GBV Helpline: 1195 (24/7)\nðŸ’¬ Text 'HELP' to crisis support\n\nYour safety is the priority. Please reach out to emergency services if you're in danger right now.\n\nIf you're safe for now, I can help you with the reporting process."
            ]
        },
        evidence: {
            keywords: ['evidence', 'proof', 'document', 'photo', 'file', 'upload', 'pictures'],
            responses: [
                "Evidence can strengthen your report, but it's NOT required. You can upload:\n\nðŸ“„ Photos of injuries\nðŸ“„ Screenshots of messages\nðŸ“„ Medical reports\nðŸ“„ Any other relevant documents\n\nIf you don't have evidence, that's okay. Your testimony is valid and important. File size limit is 10MB per file."
            ]
        },
        whatHappensNext: {
            keywords: ['what happens', 'next', 'after', 'then', 'process', 'follow up', 'response'],
            responses: [
                "After you submit your report:\n\n1ï¸âƒ£ You'll receive a confirmation message\n2ï¸âƒ£ Your report goes to our trained staff\n3ï¸âƒ£ Staff will review within 24-48 hours\n4ï¸âƒ£ You may be contacted if you provided contact info\n5ï¸âƒ£ Support services will be offered\n6ï¸âƒ£ Your case will be tracked through resolution\n\nYou can check the status: Pending â†’ In Progress â†’ Handled"
            ]
        },
        support: {
            keywords: ['support', 'help available', 'services', 'counseling', 'therapy', 'shelter'],
            responses: [
                "Support services available:\n\nðŸ’š Counseling & Therapy\nðŸ  Safe shelter options\nâš–ï¸ Legal assistance\nðŸ¥ Medical support\nðŸ’¼ Employment resources\nðŸ‘¥ Support groups\n\nAfter reporting, our team will connect you with appropriate services based on your needs."
            ]
        },
        anonymous: {
            keywords: ['anonymous', 'without name', 'no contact', 'dont want to share'],
            responses: [
                "Yes, you can report anonymously!\n\nâœ“ Name field is optional\nâœ“ Contact info is optional\nâœ“ You control what you share\n\nHowever, providing contact information helps us:\nâ€¢ Follow up with you\nâ€¢ Offer direct support\nâ€¢ Keep you updated\n\nThe choice is entirely yours."
            ]
        },
        legal: {
            keywords: ['legal', 'police', 'court', 'law', 'justice', 'prosecution', 'charges'],
            responses: [
                "Legal options and support:\n\nâš–ï¸ Filing a police report\nâš–ï¸ Obtaining protection orders\nâš–ï¸ Legal representation assistance\nâš–ï¸ Court accompaniment\nâš–ï¸ Understanding your rights\n\nOur team can connect you with legal advocates who specialize in GBV cases. You decide if and when to pursue legal action."
            ]
        },
        notSure: {
            keywords: ['not sure', 'dont know', 'unsure', 'confused', 'help me decide'],
            responses: [
                "It's completely normal to feel uncertain. Take your time.\n\nSome things to consider:\nâ€¢ You don't have to decide everything now\nâ€¢ You can start by just talking to someone\nâ€¢ Reporting doesn't automatically mean legal action\nâ€¢ You're in control of the process\n\nWould you like to know more about:\nâ€¢ The reporting process?\nâ€¢ Available support services?\nâ€¢ What happens after reporting?"
            ]
        },
        thankYou: {
            keywords: ['thank you', 'thanks', 'appreciate', 'grateful'],
            responses: [
                "You're welcome! Your courage in seeking information or help is admirable. Remember:\n\nðŸ’œ You are not alone\nðŸ’œ What happened is not your fault\nðŸ’œ Help is available\nðŸ’œ You deserve support\n\nIs there anything else I can help you with?"
            ]
        }
    };
    
    // Default responses for unmatched queries
    const defaultResponses = [
        "I'm here to help you with information about reporting violence and accessing support. Could you rephrase your question?\n\nI can help with:\nâ€¢ How to report an incident\nâ€¢ Confidentiality and privacy\nâ€¢ Types of violence you can report\nâ€¢ What happens after reporting\nâ€¢ Available support services\nâ€¢ Emergency resources",
        
        "I want to make sure I understand your question correctly. Could you ask in a different way?\n\nYou can also try asking about:\nâœ“ Reporting process\nâœ“ Safety and confidentiality\nâœ“ Support services\nâœ“ Emergency help",
    ];
    
    // Analyze message and find best response
    function analyzeMessage(message) {
        const lowerMessage = message.toLowerCase();
        let bestMatch = null;
        let highestScore = 0;
        
        // Check each category
        for (const [category, data] of Object.entries(knowledgeBase)) {
            let score = 0;
            
            // Count matching keywords
            for (const keyword of data.keywords) {
                if (lowerMessage.includes(keyword)) {
                    score += keyword.split(' ').length; // Multi-word phrases get higher scores
                }
            }
            
            if (score > highestScore) {
                highestScore = score;
                bestMatch = data;
            }
        }
        
        // Return best match or default
        if (highestScore > 0) {
            const responses = bestMatch.responses;
            return responses[Math.floor(Math.random() * responses.length)];
        } else {
            return defaultResponses[Math.floor(Math.random() * defaultResponses.length)];
        }
    }
    
    // Toggle chatbot
    document.getElementById('chatbot-toggle').addEventListener('click', function() {
        const window = document.getElementById('chatbot-window');
        window.classList.toggle('active');
        
        if (window.classList.contains('active')) {
            document.getElementById('chat-badge').style.display = 'none';
        }
    });
    
    document.getElementById('chatbot-close').addEventListener('click', function() {
        document.getElementById('chatbot-window').classList.remove('active');
    });
    
    // Send message function
    function sendMessage(message) {
        if (!message.trim()) return;
        
        // Add user message to chat
        addMessage(message, 'user');
        
        // Clear input
        document.getElementById('chatbot-message-input').value = '';
        
        // Hide suggestions after first message
        const suggestions = document.getElementById('chatbot-suggestions');
        if (conversationHistory.length === 0) {
            suggestions.style.display = 'none';
        }
        
        // Show typing indicator
        document.getElementById('chatbot-typing').style.display = 'flex';
        
        // Simulate thinking time (500-1500ms)
        const thinkingTime = 500 + Math.random() * 1000;
        
        setTimeout(() => {
            // Hide typing indicator
            document.getElementById('chatbot-typing').style.display = 'none';
            
            // Get response
            const response = analyzeMessage(message);
            
            // Add bot message to chat
            addMessage(response, 'bot');
            
            // Store in history
            conversationHistory.push({
                user: message,
                bot: response,
                timestamp: new Date()
            });
        }, thinkingTime);
    }
    
    // Add message to chat
    function addMessage(text, sender) {
        const messagesContainer = document.getElementById('chatbot-messages');
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${sender}-message`;
        
        const avatar = document.createElement('div');
        avatar.className = 'message-avatar';
        avatar.innerHTML = sender === 'bot' ? '<i class="bi bi-robot"></i>' : '<i class="bi bi-person-fill"></i>';
        
        const content = document.createElement('div');
        content.className = 'message-content';
        
        const textP = document.createElement('p');
        textP.style.whiteSpace = 'pre-line'; // Preserve line breaks
        textP.textContent = text;
        
        const time = document.createElement('small');
        time.className = 'message-time';
        time.textContent = 'Just now';
        
        content.appendChild(textP);
        content.appendChild(time);
        
        messageDiv.appendChild(avatar);
        messageDiv.appendChild(content);
        
        messagesContainer.appendChild(messageDiv);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }
    
    // Send button click
    document.getElementById('chatbot-send').addEventListener('click', function() {
        const input = document.getElementById('chatbot-message-input');
        sendMessage(input.value);
    });
    
    // Enter key to send
    document.getElementById('chatbot-message-input').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            sendMessage(this.value);
        }
    });
    
    // Suggestion buttons
    document.querySelectorAll('.suggestion-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const message = this.getAttribute('data-message');
            document.getElementById('chatbot-message-input').value = message;
            sendMessage(message);
        });
    });
</script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>